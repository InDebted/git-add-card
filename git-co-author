#!/usr/bin/env bash

set -eu

if [ "$#" -lt 1 ]
then
  >&2 echo "Attribute git commits to multiple authors.

Usage:
  git co-author initials ..."
  exit 1
fi

if ! git config commit.template &> /dev/null
then
  >&2 echo "git commit template is not configured

Example:
    git config --global commit.template '~/.git-template'"
  exit 1
fi

for initials in "$@"
do
    if ! git config "co-authors.$initials" &> /dev/null
    then
      >&2 echo "initials '$initials' are not configured

Example:
    git config --global co-authors.$initials 'NAME <USERNAME@users.noreply.github.com>'"
      exit 1
    fi
done

template_path=$(git config commit.template)
template_path="${template_path/#\~/$HOME}"  # Replace '~' with $HOME

echo "
" > "$template_path"

for initials in "$@"
do
    author=$(git config "co-authors.$initials")
    echo "Co-authored-by: $author" | tee -a "$template_path"
done
